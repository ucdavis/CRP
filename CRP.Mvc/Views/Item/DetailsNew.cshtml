@using CRP.Controllers.Helpers
@using CRP.Core.Helpers
@using Microsoft.Azure
@model CRP.Controllers.ViewModels.ItemDetailViewModel

@{
    ViewBag.Title = "UC Davis Registration";
    Layout = "~/Views/Shared/_PublicLayout.cshtml";    
}



<div class="main">
    <div class="eventbanner">
        <div class="eventbanner-image">
            <img src="@Url.Action("GetImage", "Item", new {id = Model.Item.Id})" alt="x" />
        </div>
        <div class="eventbanner-map">
            @if (Model.HasMapPins)
            {
                <div>@Html.ActionLink("Full Screen Map", "Map", new { id = Model.Item.Id, usePins = true }, new { target = "_blank" })</div>
                <div>@Html.ActionLink("Full Screen Map With Directions", "MapDirections", new { id = Model.Item.Id, usePins = true }, new { target = "_blank" })</div>
                <div id="map" style="margin: 0px 0px 20px;">
                    <div class="gp-map" style="height: 450px; width: 450px;"></div>

                    @foreach (var a in Model.Item.MapPins.OrderByDescending(a => a.IsPrimary))
                    {
                        <div class="gp-coordinate@(a.IsPrimary ? " gp-default" : string.Empty)" data-lat="@a.Latitude" data-lng="@a.Longitude">
                            <dt class="gp-name">@Html.Encode(a.Title)</dt>
                            @if (!string.IsNullOrWhiteSpace(a.Description))
                            {
                                <dd class="gp-description">@Html.Encode(a.Description ?? string.Empty)</dd>
                            }
                        </div>
                    }
                </div>
            }
        </div>
    </div>
    <div class="content_wrapper boundary">
        <article>
            <h1>@Model.Item.Name</h1>
            @Html.Raw(Html.HtmlEncode(Model.Item.Description))
            @if (!string.IsNullOrEmpty(Model.Item.Link))
            {
                <h2>Link:</h2>
                <a target="_blank" href="@Html.Encode(Model.Item.Link)">@Html.Encode(Model.Item.Link)</a>
            }
        </article>
        <aside>
            @foreach (var ep in Model.Item.ExtendedPropertyAnswers.Where(a => a.Answer != string.Empty))
            {
                <div class="eventinfo-item">
                    <div class="eventinfo-icon">
                        @if (ep.ExtendedProperty.QuestionType.Name == "Date")
                        {
                            <img src="@Url.Content("~/Images/Media/date_icon.svg")" alt="calendar icon">
                        }
                        else
                        {
                            if (ep.ExtendedProperty.Name.ToLower().Contains("location"))
                            {
                                <img src="@Url.Content("~/Images/Media/location_icon.svg")" alt="Location icon">
                            }                            
                        }
                    </div>
                    <div class="eventinfo-text">
                        <h4>@Html.Encode(ep.ExtendedProperty.Name):</h4>
                        <p>@Html.Encode(ep.ExtendedProperty.QuestionType.Name == "Text Box" ? ep.Answer : Convert.ToDateTime(ep.Answer).ToString("D"))</p>
                    </div>
                </div>
            }
            <div class="eventinfo-item">
                <div class="eventinfo-icon">
                    <img src="@Url.Content("~/Images/Media/payment_icon.svg")" alt="payment icon">
                </div>
                <div class="eventinfo-text">
                    <h4>Price Per @Html.Encode(Model.Item.QuantityName):</h4>
                    <p>@Html.Encode(String.Format("{0:C}", Model.Item.CostPerItem))</p>
                </div>
            </div><div class="eventinfo-item">
                <div class="eventinfo-icon">
                    <img src="@Url.Content("~/Images/Media/date_icon.svg")" alt="calendar icon">
                </div>
                <div class="eventinfo-text">
                    <h4>Last day to register online:</h4>
                    <p>@Html.Encode(String.Format("{0:D}", Model.Item.Expiration))</p>
                </div>
            </div>

            @if (Model.Item.Expiration >= DateTime.UtcNow.ToPacificTime().Date)
            {
                <div class="registerbtn">
                    <a class="btn btn-register" href="@Url.Action("Checkout", "Transaction", new {id=Model.Item.Id} )">Register</a>
                    <p class="discreet t-center">Register by @Html.Encode(Model.Item.Expiration.Value.ToString("MMM d")) <sup>@Model.Item.Expiration.DaySuffix()</sup></p>
                </div>
            }

        </aside>
    </div>
</div>

@section AdditionalScripts
{
    <script src="https://maps-api-ssl.google.com/maps/api/js?v=3&sensor=false&key=@CloudConfigurationManager.GetSetting("MapsApi")" type="text/javascript"></script>
    
    <script type="text/javascript" src="@Url.Content("~/Scripts/jquery.gPositions.js")"></script>

    <script type="text/javascript">
        $(function () {
            $("#map").gPositions({ helpIcon: '@Url.Content("~/Images/question_blue.png")' });
            $(".gp-sidecontainer-title img").attr("title", "");
            $(".gp-sidecontainer-title img").bt("To view Locations on the map, click on the tabs below", { positions: 'top' });
        });
    </script>
}
@section AdditionalStyles
{
    <link href="@Url.Content("~/Content/jquery.gPositions.css")" rel="Stylesheet" type="text/css" />
}
